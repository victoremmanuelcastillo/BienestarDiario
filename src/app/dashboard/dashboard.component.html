<div class="dashboard-container">
  <!-- Header con saludo -->
  <div class="welcome-section">
    <h1 class="welcome-title">{{ greeting }}, {{ userName }}! ğŸ‘‹</h1>
    <p class="date">{{ currentDate | date:'EEEE, d \'de\' MMMM \'del\' y':'es' }}</p>
  </div>

  <!-- Mensaje de felicitaciÃ³n cuando todo estÃ¡ completado -->
  <div class="completion-message" *ngIf="stats.completionRate === 100 && stats.totalActivities > 0" [@slideIn]>
    <h3>ğŸ‰ Â¡Felicitaciones!</h3>
    <p>Has completado todas tus actividades del dÃ­a. Â¡Sigue Con Esa Motivacion!</p>
  </div>

  <!-- EstadÃ­sticas rÃ¡pidas -->
  <div class="stats-grid" [class.all-completed]="stats.completionRate === 100 && stats.totalActivities > 0">
    <div class="stat-card">
      <div class="stat-icon">ğŸ“‹</div>
      <div class="stat-content">
        <h3>Actividades Hoy</h3>
        <p class="stat-number">{{ stats.totalActivities }}</p>
      </div>
    </div>
    
    <div class="stat-card">
      <div class="stat-icon">âœ…</div>
      <div class="stat-content">
        <h3>Completadas</h3>
        <p class="stat-number">{{ stats.completedToday }}</p>
      </div>
    </div>
    
    <div class="stat-card">
      <div class="stat-icon">ğŸ”¥</div>
      <div class="stat-content">
        <h3>Racha MÃ¡xima</h3>
        <p class="stat-number">{{ stats.currentStreak }} dÃ­as</p>
      </div>
    </div>
    
    <div class="stat-card">
      <div class="stat-icon">ğŸ“Š</div>
      <div class="stat-content">
        <h3>Progreso Hoy</h3>
        <p class="stat-number">{{ stats.completionRate }}%</p>
      </div>
    </div>
  </div>

  <!-- SecciÃ³n de actividades -->
  <div class="activities-section">
    <div class="section-header">
      <h2>Mis Actividades de Hoy</h2>
      <button 
        class="btn-add" 
        (click)="showAddActivity = !showAddActivity"
        type="button"
        [attr.aria-expanded]="showAddActivity"
        [attr.aria-label]="showAddActivity ? 'Cerrar formulario de nuevo hÃ¡bito' : 'Abrir formulario para agregar nuevo hÃ¡bito'"
        title="Agregar nuevo hÃ¡bito"
      >
        <span class="btn-icon" aria-hidden="true">â•</span>
        Nuevo Habito
      </button>
    </div>

    <!-- Formulario para agregar actividad -->
    <div class="add-activity-form" *ngIf="showAddActivity" [@slideIn]>
      <h3>Agregar Nuevo habito</h3>
      
      <div class="form-group">
        <label for="activity-title">TÃ­tulo *</label>
        <input 
          id="activity-title"
          type="text" 
          [(ngModel)]="newActivity.title" 
          placeholder="Ej: Lavarme los dientes"
          class="form-control"
        >
      </div>

      <div class="form-group">
        <label for="activity-description">DescripciÃ³n (opcional)</label>
        <textarea 
          id="activity-description"
          [(ngModel)]="newActivity.description" 
          placeholder="Detalles adicionales..."
          class="form-control"
          rows="2"
        ></textarea>
      </div>

      <div class="form-group">
        <label>CategorÃ­a</label>
        <div class="category-grid" role="group" aria-label="Seleccionar categorÃ­a del hÃ¡bito">
          <button 
            *ngFor="let cat of categories"
            class="category-btn"
            type="button"
            [class.active]="newActivity.category === cat.value"
            (click)="newActivity.category = cat.value"
            [style.border-color]="newActivity.category === cat.value ? cat.color : 'transparent'"
            [attr.aria-label]="'Seleccionar categorÃ­a ' + cat.name"
            [attr.aria-pressed]="newActivity.category === cat.value"
            [attr.title]="'CategorÃ­a: ' + cat.name"
          >
            <span class="category-icon" aria-hidden="true">{{ cat.icon }}</span>
            <span>{{ cat.name }}</span>
          </button>
        </div>
      </div>

      <div class="form-group">
        <label for="activity-frequency">Frecuencia</label>
        <select 
          id="activity-frequency" 
          [(ngModel)]="newActivity.frequency" 
          class="form-control" 
          title="Seleccionar frecuencia"
          aria-label="Seleccionar frecuencia del hÃ¡bito"
        >
          <option value="daily">Diario</option>
          <option value="weekly">Semanal</option>
          <option value="monthly">Mensual</option>
          <option value="custom">DÃ­as especÃ­ficos</option>
        </select>
      </div>

      <!-- Selector de dÃ­as para frecuencia personalizada -->
      <div class="form-group" *ngIf="newActivity.frequency === 'custom'">
        <label>Selecciona los dÃ­as</label>
        <div class="days-selector" role="group" aria-label="Seleccionar dÃ­as de la semana">
          <label 
            *ngFor="let day of weekDays; let i = index" 
            class="day-checkbox"
            [class.selected]="day.selected"
            [attr.aria-label]="'Seleccionar ' + day.name"
          >
            <input 
              type="checkbox" 
              [(ngModel)]="day.selected"
              class="hidden-checkbox"
              [id]="'day-checkbox-' + i"
              [attr.title]="'Seleccionar ' + day.name"
              [attr.aria-label]="'Seleccionar ' + day.name + ' para repetir el hÃ¡bito'"
            >
            <span>{{ day.name.substring(0, 3) }}</span>
          </label>
        </div>
      </div>

      <!-- Selector de dÃ­a del mes -->
      <div class="form-group" *ngIf="newActivity.frequency === 'monthly'">
        <label for="day-of-month">DÃ­a del mes</label>
        <input 
          id="day-of-month"
          type="number" 
          [(ngModel)]="newActivity.customDayOfMonth" 
          min="1" 
          max="31"
          class="form-control"
          title="Seleccionar dÃ­a del mes (1-31)"
          placeholder="DÃ­a (1-31)"
          aria-label="DÃ­a del mes para repetir el hÃ¡bito"
        >
      </div>

      <div class="form-actions">
        <button 
          class="btn btn-primary" 
          (click)="addActivity()"
          type="button"
          [disabled]="!newActivity.title.trim()"
          aria-label="Agregar nueva actividad"
          title="Agregar nueva actividad a la lista"
        >
          Agregar Actividad
        </button>
        <button 
          class="btn btn-secondary" 
          (click)="resetForm()"
          type="button"
          aria-label="Cancelar y cerrar formulario"
          title="Cancelar la creaciÃ³n del hÃ¡bito"
        >
          Cancelar
        </button>
      </div>
    </div>

    <!-- Lista de actividades -->
    <div class="activities-list">
      <div 
        *ngFor="let activity of getActivitiesForToday()" 
        class="activity-card"
        [class.completed]="activity.completed"
        [@fadeIn]
      >
        <div class="activity-checkbox">
          <input 
            type="checkbox" 
            [checked]="activity.completed"
            (change)="toggleActivity(activity)"
            [id]="'activity-' + activity.id"
            [attr.title]="'Marcar ' + activity.title + ' como completado'"
            [attr.aria-label]="'Marcar ' + activity.title + ' como completado'"
          >
          <label [for]="'activity-' + activity.id" class="checkbox-label"></label>
        </div>
        
        <div class="activity-content">
          <div class="activity-header">
            <h4 [class.strikethrough]="activity.completed">{{ activity.title }}</h4>
            <span 
              class="category-badge" 
              [style.background-color]="getCategoryInfo(activity.category).color"
            >
              {{ getCategoryInfo(activity.category).icon }}
            </span>
          </div>
          
          <p class="activity-description" *ngIf="activity.description">
            {{ activity.description }}
          </p>
          
          <div class="activity-meta">
            <span class="frequency-tag">
              {{ getFrequencyText(activity) }}
            </span>
            <span class="streak" *ngIf="activity.streak > 0">
              ğŸ”¥ {{ activity.streak }} dÃ­as
            </span>
          </div>
        </div>
        
        <button 
          class="btn-delete" 
          (click)="deleteActivity(activity.id)"
          [attr.aria-label]="'Eliminar ' + activity.title"
        >
          ğŸ—‘ï¸
        </button>
      </div>

      <div class="empty-state" *ngIf="getActivitiesForToday().length === 0">
        <div class="empty-icon">ğŸ“</div>
        <h3>No tienes actividades para hoy</h3>
        <p>Â¡Agrega tu primera actividad para comenzar a crear hÃ¡bitos saludables!</p>
      </div>
    </div>
  </div>

  <!-- Componente de recomendaciones -->
  <app-habitos-recomendados 
    [habitosActuales]="activities" 
    (agregarHabito)="agregarRecomendacion($event)">
  </app-habitos-recomendados>
</div>