<!-- habits-manager.component.html - Template para gesti√≥n de h√°bitos -->
<div class="habits-manager">
  
    <!-- Bot√≥n para agregar nuevo h√°bito -->
    <div class="add-habit-section" *ngIf="showAddButton">
      <button 
        class="btn-add-habit" 
        (click)="showAddHabit = !showAddHabit"
        type="button">
        <span class="add-icon">{{ showAddHabit ? '‚ûñ' : '‚ûï' }}</span>
        <span>{{ showAddHabit ? 'Cerrar' : 'Agregar H√°bito' }}</span>
      </button>
    </div>
  
    <!-- Formulario para agregar nuevo h√°bito -->
    <div class="add-habit-form" *ngIf="showAddHabit" [@slideIn]>
      <h3>‚ú® Crear Nuevo H√°bito</h3>
      
      <div class="form-group">
        <label for="habit-title">T√≠tulo del h√°bito *:</label>
        <input 
          type="text" 
          id="habit-title"
          [(ngModel)]="newHabit.title" 
          placeholder="Ej: Meditar 10 minutos"
          class="form-input"
          required>
      </div>
  
      <div class="form-group">
        <label for="habit-description">Descripci√≥n (opcional):</label>
        <textarea 
          id="habit-description"
          [(ngModel)]="newHabit.description" 
          placeholder="Describe por qu√© este h√°bito es importante..."
          class="form-textarea"></textarea>
      </div>
  
      <div class="form-group">
        <label for="habit-category">Categor√≠a:</label>
        <select id="habit-category" [(ngModel)]="newHabit.category" class="form-select">
          <option *ngFor="let cat of categories" [value]="cat.value">
            {{ cat.icon }} {{ cat.name }}
          </option>
        </select>
      </div>
  
      <div class="form-group">
        <label for="habit-frequency">Frecuencia:</label>
        <select id="habit-frequency" [(ngModel)]="newHabit.frequency" class="form-select">
          <option value="daily">Todos los d√≠as</option>
          <option value="weekly">Semanal</option>
          <option value="monthly">Mensual</option>
          <option value="custom">D√≠as espec√≠ficos</option>
        </select>
      </div>
  
      <!-- Secci√≥n de horarios -->
      <div class="form-group">
        <div class="schedules-header">
          <label>‚è∞ Horarios y Recordatorios:</label>
          <button type="button" class="btn-add-schedule" (click)="addScheduleToForm()">
            ‚ûï Agregar horario
          </button>
        </div>
        
        <div class="schedules-simple" *ngIf="newHabit.schedules.length > 0">
          <div class="schedule-simple-card" *ngFor="let schedule of newHabit.schedules; let i = index">
            
            <!-- Selector de tipo -->
            <div class="schedule-type-selector">
              <div class="radio-group">
                <label class="radio-option">
                  <input type="radio" 
                         [name]="'schedule-type-' + i" 
                         value="time"
                         [checked]="schedule.time && schedule.time !== ''"
                         (change)="setScheduleType(schedule, 'time')">
                  <span>üïê Hora espec√≠fica</span>
                </label>
                
                <label class="radio-option">
                  <input type="radio" 
                         [name]="'schedule-type-' + i" 
                         value="period"
                         [checked]="!schedule.time || schedule.time === ''"
                         (change)="setScheduleType(schedule, 'period')">
                  <span>üìÖ Per√≠odo del d√≠a</span>
                </label>
              </div>
            </div>
  
            <!-- Selector de hora espec√≠fica -->
            <div class="time-selector" *ngIf="schedule.time && schedule.time !== ''">
              <label>Hora:</label>
              <input 
                type="time" 
                [(ngModel)]="schedule.time"
                (ngModelChange)="updateScheduleTimeOfDay(schedule, schedule.time)"
                class="time-input-simple">
              <small class="auto-period">
                Per√≠odo: {{ getTimeOfDayText(schedule.timeOfDay) }}
              </small>
            </div>
  
            <!-- Selector de per√≠odo -->
            <div class="period-selector" *ngIf="!schedule.time || schedule.time === ''">
              <label>Per√≠odo:</label>
              <select [(ngModel)]="schedule.timeOfDay" class="period-select-simple">
                <option value="morning">üåÖ Ma√±ana (06:00-12:00)</option>
                <option value="afternoon">‚òÄÔ∏è Tarde (12:01-18:00)</option>
                <option value="evening">üåô Noche (18:01-23:59)</option>
              </select>
            </div>
  
            <!-- Notificaciones -->
            <div class="schedule-options-simple">
              <label class="notification-only">
                <input type="checkbox" [(ngModel)]="schedule.notificationEnabled">
                <span>üîî Recibir notificaci√≥n</span>
              </label>
            </div>
            
            <button type="button" class="btn-remove-simple" (click)="removeScheduleFromForm(i)">
              üóëÔ∏è Eliminar
            </button>
          </div>
        </div>
      </div>
  
      <!-- D√≠as personalizados -->
      <div class="form-group" *ngIf="newHabit.frequency === 'custom'">
        <label>D√≠as de la semana:</label>
        <div class="days-selector">
          <label *ngFor="let day of weekDays" class="day-checkbox">
            <input 
              type="checkbox" 
              [value]="day.value"
              [checked]="newHabit.customDays.includes(day.value)"
              (change)="toggleCustomDay($event, day.value)">
            <span>{{ day.name.substring(0, 3) }}</span>
          </label>
        </div>
      </div>
  
      <!-- D√≠a del mes -->
      <div class="form-group" *ngIf="newHabit.frequency === 'monthly'">
        <label for="custom-day">D√≠a del mes (1-31):</label>
        <input 
          type="number" 
          id="custom-day"
          [(ngModel)]="newHabit.customDayOfMonth" 
          min="1" 
          max="31" 
          class="form-input">
      </div>
  
      <div class="form-actions">
        <button 
          type="button" 
          class="btn-create" 
          (click)="addHabit()"
          [disabled]="!newHabit.title.trim()">
          <span>‚ú® Crear H√°bito</span>
        </button>
        
        <button 
          type="button" 
          class="btn-cancel" 
          (click)="cancelForm()">
          <span>‚ùå Cancelar</span>
        </button>
      </div>
    </div>
  
    <!-- Lista de h√°bitos organizados por per√≠odo del d√≠a -->
    <div class="habits-by-time" *ngIf="habits.length > 0">
      <div class="time-period-container" *ngFor="let period of timeOfDayPeriods" 
           [class.current-period]="getCurrentTimeOfDay() === period.value">
        
        <div class="time-period-header">
          <div class="period-info">
            <span class="period-icon">{{ period.icon }}</span>
            <h3>{{ period.name }}</h3>
            <span class="time-range">{{ period.timeRange }}</span>
          </div>
          <div class="period-stats">
            <span class="habits-count">
              {{ getHabitsByTimeOfDay(period.value).length }} h√°bitos
            </span>
          </div>
        </div>
  
        <div class="habits-list" *ngIf="getHabitsByTimeOfDay(period.value).length > 0">
          <div class="habit-card" 
               *ngFor="let habit of getHabitsByTimeOfDay(period.value); trackBy: trackByHabitId"
               [class.completed]="habit.completed"
               [class.editing]="habit.isEditing"
               [@fadeIn]>
            
            <!-- Vista normal del h√°bito -->
            <div class="habit-content" *ngIf="!habit.isEditing">
              
              <div class="habit-main">
                <div class="habit-header">
                  <div class="habit-title-section">
                    <span class="category-icon" [style.color]="getCategoryInfo(habit.category).color">
                      {{ getCategoryInfo(habit.category).icon }}
                    </span>
                    <div class="habit-info">
                      <h4 class="habit-title">{{ habit.title }}</h4>
                      <p class="habit-description" *ngIf="habit.description">{{ habit.description }}</p>
                    </div>
                  </div>
                  
                  <div class="habit-actions">
                    <button class="btn-icon edit" (click)="startEditHabit(habit)" title="Editar">
                      ‚úèÔ∏è
                    </button>
                    <button class="btn-icon delete" (click)="deleteHabit(habit)" title="Eliminar">
                      üóëÔ∏è
                    </button>
                  </div>
                </div>
  
                <!-- Botones de completado por horario espec√≠fico -->
                <div class="habit-schedules-with-buttons">
                  <div class="schedule-completion-item" 
                       *ngFor="let schedule of getActiveSchedulesForPeriod(habit, period.value)">
                    
                    <button 
                      class="btn-complete-schedule" 
                      [class.completed]="isScheduleCompletedToday(habit, schedule)"
                      (click)="toggleScheduleCompletion(habit, schedule)">
                      <span class="complete-icon">{{ isScheduleCompletedToday(habit, schedule) ? '‚úÖ' : '‚≠ï' }}</span>
                      <span class="complete-text">{{ isScheduleCompletedToday(habit, schedule) ? 'Hecho' : 'Hacer' }}</span>
                    </button>
                    
                    <div class="schedule-info">
                      <span class="schedule-time">{{ schedule.time || getPeriodDisplayName(schedule.timeOfDay) }}</span>
                      <span class="notification-icon" *ngIf="schedule.notificationEnabled">üîî</span>
                    </div>
                  </div>
                </div>
  
                <div class="habit-meta">
                  <span class="frequency">{{ getFrequencyText(habit) }}</span>
                  <span class="category">{{ getCategoryInfo(habit.category).name }}</span>
                  <span class="streak" *ngIf="habit.streak > 0">üî• {{ habit.streak }} d√≠as</span>
                </div>
              </div>
            </div>
  
            <!-- Formulario de edici√≥n -->
            <div class="edit-form" *ngIf="habit.isEditing">
              <div class="form-group">
                <label>T√≠tulo del h√°bito:</label>
                <input 
                  type="text" 
                  [(ngModel)]="editForm.title" 
                  class="form-input">
              </div>
  
              <div class="form-group">
                <label>Descripci√≥n (opcional):</label>
                <textarea 
                  [(ngModel)]="editForm.description" 
                  class="form-textarea"></textarea>
              </div>
  
              <div class="form-group">
                <label>Categor√≠a:</label>
                <select [(ngModel)]="editForm.category" class="form-select">
                  <option *ngFor="let cat of categories" [value]="cat.value">
                    {{ cat.icon }} {{ cat.name }}
                  </option>
                </select>
              </div>
  
              <div class="form-group">
                <label>Frecuencia:</label>
                <select [(ngModel)]="editForm.frequency" class="form-select">
                  <option value="daily">Todos los d√≠as</option>
                  <option value="weekly">Semanal</option>
                  <option value="monthly">Mensual</option>
                  <option value="custom">D√≠as espec√≠ficos</option>
                </select>
              </div>
  
              <div class="edit-actions">
                <button type="button" class="btn-save" (click)="saveEditHabit()">
                  üíæ Guardar
                </button>
                <button type="button" class="btn-cancel" (click)="cancelEditHabit()">
                  ‚ùå Cancelar
                </button>
              </div>
            </div>
          </div>
        </div>
  
        <!-- Mensaje cuando no hay h√°bitos -->
        <div class="no-habits" *ngIf="getHabitsByTimeOfDay(period.value).length === 0">
          <p>No hay h√°bitos programados para {{ period.name.toLowerCase() }}</p>
        </div>
      </div>
    </div>
  
    <!-- Mensaje cuando no hay h√°bitos -->
    <div class="empty-state" *ngIf="habits.length === 0">
      <div class="empty-icon">üåü</div>
      <h3>¬°Comienza tu viaje de h√°bitos!</h3>
      <p>Crea tu primer h√°bito y transforma tu d√≠a a d√≠a</p>
    </div>
  </div>